<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.css">
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-xmlrpc/0.4.3/jquery.xmlrpc.js">
    </script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
    <script src="http://vjs.zencdn.net/7.8.4/video.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js"></script>
    
  
    <script>
        id = decodeURIComponent(window.location.search);
        id = id.substring(1);
        console.log(id);
        $(document).ready(function() {
            var vPlayer = videojs('videoPlayer');
            vPlayer.src({
                "type": "video/youtube",
                "src": "https://www.youtube.com/watch?v=xjS6SftYQaQ"
            });
            vPlayer.play()

            $("#buttonVideoPause").click(function() {
                vPlayer.pause()
                var pauseTime = vPlayer.currentTime()
                console.log(pauseTime)
                $("#resumetime").val(pauseTime)

            })
            $("#buttonVideoResume").click(function() {
                    vPlayer.currentTime(parseFloat($("#resumetime").val()))
                    vPlayer.play()
                })
                //TODO 6 - get the value of #playVideoID

            $.ajax({
                //TODO 7 - retrieve the corresponding URL by
                //        calling the /videos/<id>/ REST endpoint)
                url: '/API/videos/' + id + '/',
                type: "GET",
                dataType: "json",
                success: function(data) {
                    console.log(data)
                    url = data["url"]
                    $("#desc").html("Playing: " + data["description"]);
                    console.log(url)
                        //TODO 8 - update the player with the url retrieved
                    vPlayer.src({
                        "type": "video/youtube",
                        "src": url
                    });
                    vPlayer.play()

                    $.ajax({
                        //TODO 9 - increase the number of views
                        url: '/API/videos/' + id + '/views',
                        type: "PUT",
                        dataType: "json",
                        success: function(data) {
                            console.log(data)
                        }
                    })
                }
            });

            function updateVideostable() {
                $.ajax({
                    url: '/API/videos/',
                    type: "GET",
                    dataType: "json",
                    success: function(data) {
                        console.log(data);
                        $('#questionsTable > tbody:last-child').empty()
                        data["videos"].forEach(v => {
                            console.log(v["video_id"] + " " + v["description"])
                            $('#videosTable > tbody:last-child').
                            append('<tr> <td>' + v["video_id"] + '</td><td>' + v["description"] + '</td><td id="nviews' + v["video_id"] + '">xxx</td></tr>');
                        });
                    }
                });
            }

            // TODO 11 - update the table

        });
    </script>

</head>

<body>
    <h1 id="desc"></h1>
    <div class="display:inline-block">
        <video id="videoPlayer" controls class="video-js vjs-default-skin" width="640" data-setup='{ "autoplay": true, "preload": "auto", "techOrder": ["youtube"], "sources": [{ "type": "video/youtube" }'>
        </video>
        <table class="ui celled table selectable" id="questionsTable">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Question</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <h3>Control Video</h3>
    <button class="ui button" id="buttonVideoPause">PAUSE Video</button>
    <div class="ui input focus">
        <input type="text" id="resumetime">
    </div>
    <button class="ui button" id="buttonVideoResume">RESUME Video</button>
</body>

</html>